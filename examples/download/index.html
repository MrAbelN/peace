<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
  </head>
  <body>
    <script type="module">
      import init, * as exports from './pkg/download.js';

      window.onload = async function() {
        await init();

        let graph_and_content_global;


        document.querySelector("#init").addEventListener('click', () => {
          const name = document.querySelector("#name").value;
          const url = document.querySelector("#url").value;
          exports.wasm_setup(url, name)
            .then(graph_and_content => {
              graph_and_content_global = graph_and_content;
              document.querySelectorAll(".init_required").forEach(element => element.removeAttribute("disabled"));
            });
        });

        document.querySelector("#status").addEventListener('click', () => {
          exports.wasm_status(graph_and_content_global)
            .then(graph_and_content => graph_and_content_global = graph_and_content);
        });

        document.querySelector("#desired").addEventListener('click', () => {
          exports.wasm_desired(graph_and_content_global)
            .then(graph_and_content => graph_and_content_global = graph_and_content);
        });

        document.querySelector("#diff").addEventListener('click', () => {
          exports.wasm_diff(graph_and_content_global)
            .then(graph_and_content => graph_and_content_global = graph_and_content);
        });

        document.querySelector("#ensure_dry").addEventListener('click', () => {
          exports.wasm_ensure_dry(graph_and_content_global)
            .then(graph_and_content => graph_and_content_global = graph_and_content);
        });
        document.querySelector("#ensure").addEventListener('click', () => {
          exports.wasm_ensure(graph_and_content_global)
            .then(graph_and_content => graph_and_content_global = graph_and_content);
        });
      };
    </script>

    <label for="url">URL:</label><input id="url" value="http://ipecho.net/plain" /><br/>
    <label for="name">Name:</label><input id="name" value="ip.json" /><br/>
    <button id="init">Init</button>
    <button id="status" class="init_required" disabled>Status</button>
    <button id="desired" class="init_required" disabled>Desired</button>
    <button id="diff" class="init_required" disabled>Diff</button>
    <button id="ensure_dry" class="init_required" disabled>Ensure (dry run)</button>
    <button id="ensure" class="init_required" disabled>Ensure</button>
  </body>
</html>
